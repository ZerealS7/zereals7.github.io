<!doctype html>
<html lang="en-us">
  <head>
    <title>hugo增加搜索模块 // Zereal-宋致远技术博客</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.72.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1，minimum-scale=0.1, maximum-scale=2.0, user-scalable=yes" />
    <meta name="author" content="Zereal" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://zereals7.github.io/css/main.min.f90f5edd436ec7b74ad05479a05705770306911f721193e7845948fb07fe1335.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="hugo增加搜索模块"/>
<meta name="twitter:description" content="前言 之前主题里面采用的是谷歌的站内搜索，感觉不是太好，所以想找找替代方案。Hugo 官方文档里面提供了几种方案，最后采用了Algolia，以下为折腾过程。
Algolia属于商业解决方案，但是提供了免费计划，对于我这种小站免费就够用了。
参考教程：
 Add Algolia Search To Hugo Static Website Static site search with Hugo &#43; Algolia  Index 配置过程 生成 Algolia 端索引  前往Algolia注册，然后前往Algolia 主页，点击NEW APPLICATION，Name可选，方案选择FREE，然后创建，随后的地区选择邻近地区即可；
new-application.png 选择地区后会跳转到Dashboard，此时点击侧栏的Indices，然后点击Create Index，Index name自定义（例如自己的域名）；
algolia-index.png 点击侧栏API Keys，记住以下的 keys，之后都会用到；
api-keys.png  本地生成搜索索引   自定义输出格式，在config.toml中添加以下内容：
[outputFormats.Algolia] baseName = &#34;algolia&#34; isPlainText = true mediaType = &#34;application/json&#34; notAlternative = true [params.algolia] vars = [&#34;title&#34;, &#34;summary&#34;, &#34;date&#34;, &#34;publishdate&#34;, &#34;expirydate&#34;, &#34;permalink&#34;] params = [&#34;categories&#34;, &#34;tags&#34;,&#34;series&#34;]  vars是 Hugo 内置变量； params是自定义变量，按自己情况增减。"/>

    <meta property="og:title" content="hugo增加搜索模块" />
<meta property="og:description" content="前言 之前主题里面采用的是谷歌的站内搜索，感觉不是太好，所以想找找替代方案。Hugo 官方文档里面提供了几种方案，最后采用了Algolia，以下为折腾过程。
Algolia属于商业解决方案，但是提供了免费计划，对于我这种小站免费就够用了。
参考教程：
 Add Algolia Search To Hugo Static Website Static site search with Hugo &#43; Algolia  Index 配置过程 生成 Algolia 端索引  前往Algolia注册，然后前往Algolia 主页，点击NEW APPLICATION，Name可选，方案选择FREE，然后创建，随后的地区选择邻近地区即可；
new-application.png 选择地区后会跳转到Dashboard，此时点击侧栏的Indices，然后点击Create Index，Index name自定义（例如自己的域名）；
algolia-index.png 点击侧栏API Keys，记住以下的 keys，之后都会用到；
api-keys.png  本地生成搜索索引   自定义输出格式，在config.toml中添加以下内容：
[outputFormats.Algolia] baseName = &#34;algolia&#34; isPlainText = true mediaType = &#34;application/json&#34; notAlternative = true [params.algolia] vars = [&#34;title&#34;, &#34;summary&#34;, &#34;date&#34;, &#34;publishdate&#34;, &#34;expirydate&#34;, &#34;permalink&#34;] params = [&#34;categories&#34;, &#34;tags&#34;,&#34;series&#34;]  vars是 Hugo 内置变量； params是自定义变量，按自己情况增减。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zereals7.github.io/post/hugo%E5%A2%9E%E5%8A%A0%E6%90%9C%E7%B4%A2%E6%A8%A1%E5%9D%97/" />
<meta property="article:published_time" content="2020-06-27T10:40:50+08:00" />
<meta property="article:modified_time" content="2020-06-27T10:40:50+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://zereals7.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Zereal" /></a>
      <h1>Zereal</h1>
      <p>Java coder</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/ZerealS7" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">hugo增加搜索模块</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 27, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div></div>
    </header>
    <div class="post-content">
      <h2 id="前言">前言</h2>
<p>之前主题里面采用的是谷歌的站内搜索，感觉不是太好，所以想找找替代方案。<a href="https://gohugo.io/tools/search/">Hugo 官方文档</a>里面提供了几种方案，最后采用了<a href="https://www.algolia.com/">Algolia</a>，以下为折腾过程。</p>
<p><a href="https://www.algolia.com/">Algolia</a>属于商业解决方案，但是提供了免费计划，对于我这种小站免费就够用了。</p>
<p>参考教程：</p>
<ul>
<li><a href="https://code.luasoftware.com/tutorials/algolia/add-algolia-search-to-hugo-static-website/">Add Algolia Search To Hugo Static Website</a></li>
<li><a href="https://forestry.io/blog/search-with-algolia-in-hugo/">Static site search with Hugo + Algolia</a></li>
</ul>
<h2 id="index-配置过程">Index 配置过程</h2>
<h3 id="生成-algolia-端索引">生成 Algolia 端索引</h3>
<ul>
<li>前往<a href="https://www.algolia.com/">Algolia</a>注册，然后前往<a href="https://www.algolia.com/manage/applications">Algolia 主页</a>，点击<strong>NEW APPLICATION</strong>，<strong>Name</strong>可选，方案选择<strong>FREE</strong>，然后创建，随后的地区选择邻近地区即可；<br>
<a href="https://i.loli.net/2018/11/23/5bf785c4b789b.png"><img src="https://i.loli.net/2018/11/23/5bf785c4b789b.png" alt="new-application.png">new-application.png</a></li>
<li>选择地区后会跳转到<strong>Dashboard</strong>，此时点击侧栏的<strong>Indices</strong>，然后点击<strong>Create Index</strong>，<strong>Index name</strong>自定义（例如自己的域名）；<br>
<a href="https://i.loli.net/2018/11/23/5bf789822d4e9.png"><img src="https://i.loli.net/2018/11/23/5bf789822d4e9.png" alt="algolia-index.png">algolia-index.png</a></li>
<li>点击侧栏<strong>API Keys</strong>，记住以下的 keys，之后都会用到；<br>
<a href="https://i.loli.net/2018/11/23/5bf78ac7e3316.png"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" alt="api-keys.png">api-keys.png</a></li>
</ul>
<h3 id="本地生成搜索索引">本地生成搜索索引</h3>
<ol>
<li>
<p>自定义输出格式，在<code>config.toml</code>中添加以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">outputFormats</span>.<span style="color:#a6e22e">Algolia</span>]
  <span style="color:#a6e22e">baseName</span> = <span style="color:#e6db74">&#34;algolia&#34;</span>
  <span style="color:#a6e22e">isPlainText</span> = <span style="color:#66d9ef">true</span>
  <span style="color:#a6e22e">mediaType</span> = <span style="color:#e6db74">&#34;application/json&#34;</span>
  <span style="color:#a6e22e">notAlternative</span> = <span style="color:#66d9ef">true</span>
   
[<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">algolia</span>]
  <span style="color:#a6e22e">vars</span> = [<span style="color:#e6db74">&#34;title&#34;</span>, <span style="color:#e6db74">&#34;summary&#34;</span>, <span style="color:#e6db74">&#34;date&#34;</span>, <span style="color:#e6db74">&#34;publishdate&#34;</span>, <span style="color:#e6db74">&#34;expirydate&#34;</span>, <span style="color:#e6db74">&#34;permalink&#34;</span>]
  <span style="color:#a6e22e">params</span> = [<span style="color:#e6db74">&#34;categories&#34;</span>, <span style="color:#e6db74">&#34;tags&#34;</span>,<span style="color:#e6db74">&#34;series&#34;</span>]
</code></pre></div><blockquote>
<p><code>vars</code>是 Hugo 内置变量；
<code>params</code>是自定义变量，按自己情况增减。</p>
</blockquote>
</li>
<li>
<p>建立 JSON 模版，在<code>layouts/_default</code>中建立一个<code>list.algolia.json</code>文件，然后粘贴以下内容保存：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{<span style="color:#960050;background-color:#1e0010">{/*</span> <span style="color:#960050;background-color:#1e0010">Generates</span> <span style="color:#960050;background-color:#1e0010">a</span> <span style="color:#960050;background-color:#1e0010">valid</span> <span style="color:#960050;background-color:#1e0010">Algolia</span> <span style="color:#960050;background-color:#1e0010">search</span> <span style="color:#960050;background-color:#1e0010">index</span> <span style="color:#960050;background-color:#1e0010">*/</span>}<span style="color:#960050;background-color:#1e0010">}</span>
{<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">$.Scratch.Add</span> <span style="color:#f92672">&#34;index&#34;</span> <span style="color:#960050;background-color:#1e0010">slice</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
{<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">$section</span> <span style="color:#960050;background-color:#1e0010">:=</span> <span style="color:#960050;background-color:#1e0010">$.Site.GetPage</span> <span style="color:#f92672">&#34;section&#34;</span> <span style="color:#960050;background-color:#1e0010">.Section</span> }<span style="color:#960050;background-color:#1e0010">}</span>
{<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">range</span> <span style="color:#960050;background-color:#1e0010">.Site.AllPages</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
  {<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">if</span> <span style="color:#960050;background-color:#1e0010">or</span> <span style="color:#960050;background-color:#1e0010">(and</span> <span style="color:#960050;background-color:#1e0010">(.IsDescendant</span> <span style="color:#960050;background-color:#1e0010">$section)</span> <span style="color:#960050;background-color:#1e0010">(and</span> <span style="color:#960050;background-color:#1e0010">(not</span> <span style="color:#960050;background-color:#1e0010">.Draft)</span> <span style="color:#960050;background-color:#1e0010">(not</span> <span style="color:#960050;background-color:#1e0010">.Params.private)))</span> <span style="color:#960050;background-color:#1e0010">$section.IsHome</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
    {<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">$.Scratch.Add</span> <span style="color:#f92672">&#34;index&#34;</span> <span style="color:#960050;background-color:#1e0010">(dict</span> <span style="color:#e6db74">&#34;objectID&#34;</span> <span style="color:#960050;background-color:#1e0010">.UniqueID</span> <span style="color:#e6db74">&#34;date&#34;</span> <span style="color:#960050;background-color:#1e0010">.Date.UTC.Unix</span> <span style="color:#e6db74">&#34;description&#34;</span> <span style="color:#960050;background-color:#1e0010">.Description</span> <span style="color:#e6db74">&#34;dir&#34;</span> <span style="color:#960050;background-color:#1e0010">.Dir</span> <span style="color:#e6db74">&#34;expirydate&#34;</span> <span style="color:#960050;background-color:#1e0010">.ExpiryDate.UTC.Unix</span> <span style="color:#e6db74">&#34;fuzzywordcount&#34;</span> <span style="color:#960050;background-color:#1e0010">.FuzzyWordCount</span> <span style="color:#e6db74">&#34;keywords&#34;</span> <span style="color:#960050;background-color:#1e0010">.Keywords</span> <span style="color:#e6db74">&#34;kind&#34;</span> <span style="color:#960050;background-color:#1e0010">.Kind</span> <span style="color:#e6db74">&#34;lang&#34;</span> <span style="color:#960050;background-color:#1e0010">.Lang</span> <span style="color:#e6db74">&#34;lastmod&#34;</span> <span style="color:#960050;background-color:#1e0010">.Lastmod.UTC.Unix</span> <span style="color:#e6db74">&#34;permalink&#34;</span> <span style="color:#960050;background-color:#1e0010">.Permalink</span> <span style="color:#e6db74">&#34;publishdate&#34;</span> <span style="color:#960050;background-color:#1e0010">.PublishDate</span> <span style="color:#e6db74">&#34;readingtime&#34;</span> <span style="color:#960050;background-color:#1e0010">.ReadingTime</span> <span style="color:#e6db74">&#34;relpermalink&#34;</span> <span style="color:#960050;background-color:#1e0010">.RelPermalink</span> <span style="color:#e6db74">&#34;summary&#34;</span> <span style="color:#960050;background-color:#1e0010">.Summary</span> <span style="color:#e6db74">&#34;title&#34;</span> <span style="color:#960050;background-color:#1e0010">.Title</span> <span style="color:#e6db74">&#34;type&#34;</span> <span style="color:#960050;background-color:#1e0010">.Type</span> <span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#960050;background-color:#1e0010">.URL</span> <span style="color:#e6db74">&#34;weight&#34;</span> <span style="color:#960050;background-color:#1e0010">.Weight</span> <span style="color:#e6db74">&#34;wordcount&#34;</span> <span style="color:#960050;background-color:#1e0010">.WordCount</span> <span style="color:#e6db74">&#34;section&#34;</span> <span style="color:#960050;background-color:#1e0010">.Section</span> <span style="color:#e6db74">&#34;tags&#34;</span> <span style="color:#960050;background-color:#1e0010">.Params.Tags</span> <span style="color:#e6db74">&#34;categories&#34;</span> <span style="color:#960050;background-color:#1e0010">.Params.Categories</span> <span style="color:#e6db74">&#34;authors&#34;</span> <span style="color:#960050;background-color:#1e0010">.Params.Authors)</span>}<span style="color:#960050;background-color:#1e0010">}</span>
  {<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">end</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
{<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">end</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
{<span style="color:#960050;background-color:#1e0010">{-</span> <span style="color:#960050;background-color:#1e0010">$.Scratch.Get</span> <span style="color:#f92672">&#34;index&#34;</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#960050;background-color:#1e0010">jsonify</span> <span style="color:#960050;background-color:#1e0010">-</span>}<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div></li>
<li>
<p>生成索引，在<code>config.toml</code>中添加以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">outputs</span>]
<span style="color:#a6e22e">home</span> = [<span style="color:#e6db74">&#34;HTML&#34;</span>, <span style="color:#e6db74">&#34;RSS&#34;</span>, <span style="color:#e6db74">&#34;Algolia&#34;</span>]
</code></pre></div></li>
<li>
<p>使用<code>hugo</code>命令，即可在<code>public</code>文件夹下看到<code>aligolia.json</code>索引文件。</p>
</li>
</ol>
<h3 id="发送索引至-algolia">发送索引至 Algolia</h3>
<p>我们将使用 NPM 包<a href="https://www.npmjs.com/package/atomic-algolia">atomic-algolia</a>来帮助我们更新<a href="https://www.algolia.com/">Algolia</a>上的 Index。</p>
<blockquote>
<p>使用 NPM 需要安装 Node，可去<a href="https://nodejs.org/en/download/">官网</a>下载</p>
</blockquote>
<ul>
<li>在博客项目文件夹下，<code>cmd</code>或者<code>bash</code>里执行以下命令：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm init  // 初始化，不懂具体内容一路回车就好
npm install atomic-algolia --save
</code></pre></div><p>执行完后会生成 <code>node_modules</code> 文件夹（如果代码托管在 GitHub 的话，可以在<code>.gitignore</code>中添加<code>/node_modules</code>以忽略该文件）。在项目根目录下还会有一个<code>package.json</code>文件，打开该文件，在<code>scripts</code>下添加<code>&quot;algolia&quot;: &quot;atomic-algolia&quot;</code>后如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"> <span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
    <span style="color:#f92672">&#34;test&#34;</span>: <span style="color:#e6db74">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>,
    <span style="color:#f92672">&#34;algolia&#34;</span>: <span style="color:#e6db74">&#34;atomic-algolia&#34;</span>
  }<span style="color:#960050;background-color:#1e0010">,</span>
</code></pre></div><p>一定要注意<code>test</code>一行后需要添加英文逗号。</p>
<ul>
<li>在博客项目根目录下建立一个<code>.env</code>文件，文件内容如下：</li>
</ul>
<pre><code>ALGOLIA_APP_ID={{ YOUR_APP_ID }}
ALGOLIA_ADMIN_KEY={{ YOUR_ADMIN_KEY }}
ALGOLIA_INDEX_NAME={{ YOUR_INDEX_NAME }}
ALGOLIA_INDEX_FILE={{ PATH/TO/algolia.json }}
</code></pre><p><strong>注意</strong>：</p>
<ol>
<li>实际填写时不需要添加花括号；</li>
<li><code>PATH/TO/algolia.json</code> 默认应填写为<code>public/algolia.json</code>。</li>
</ol>
<ul>
<li>
<p>一切就绪后，使用以下命令即可更新<a href="https://www.algolia.com/">Algolia</a>的 Index：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm run algolia
</code></pre></div></li>
</ul>
<p>没有报错的话就成功了。</p>
<h2 id="前端内容">前端内容</h2>
<p>Index 弄好之后，就差我们在自己的主题中运用<a href="https://www.algolia.com/">Algolia</a>了。以下是我用的主题内容，可以根据自己情况进行修改。</p>
<ul>
<li>
<p>建立<code>/search</code>页面：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hugo new search/_index.md
</code></pre></div></li>
</ul>
<p>具体内容看情况修改；</p>
<ul>
<li>
<p>在<code>layouts/partials/</code>下建立<code>search.html</code>文件，内容如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/instantsearch.js@2.7.1&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/instantsearch.js@2.7.1/dist/instantsearch.min.css&#34;</span>&gt;
&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/instantsearch.js@2.7.1/dist/instantsearch-theme-algolia.min.css&#34;</span>&gt;
  
  
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;search-box&#34;</span>&gt;<span style="color:#75715e">&lt;!-- SearchBox widget will appear here --&gt;</span>&lt;/<span style="color:#f92672">div</span>&gt;
<span style="color:#75715e">&lt;!-- include algolia logo --&gt;</span>
&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://www.algolia.com/static_assets/images/pricing/pricing_new/algolia-powered-by-14773f38.svg&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;float:right&#34;</span>&gt;&lt;/<span style="color:#f92672">img</span>&gt;
  
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hits&#34;</span> &gt;
  <span style="color:#75715e">&lt;!-- Hits widget will appear here --&gt;</span>
&lt;/<span style="color:#f92672">div</span>&gt;
  
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pagination&#34;</span>&gt;
  <span style="color:#75715e">&lt;!-- Pagination widget will appear here --&gt;</span>
&lt;/<span style="color:#f92672">div</span>&gt;
  
&lt;<span style="color:#f92672">script</span>&gt;
<span style="color:#75715e">// initialize instantsearch
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">search</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instantsearch</span>({
  <span style="color:#a6e22e">appId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;YOUR_APP_ID&#39;</span>,
  <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;YOUR_SEARCH_ONLY_KEY&#39;</span>,
  <span style="color:#a6e22e">indexName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;YOUR_INDEX_NAME&#39;</span>,
  <span style="color:#a6e22e">urlSync</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
});
  
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hitTemplate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">hit</span>) {
<span style="color:#75715e">/*  if (hit === null){
</span><span style="color:#75715e"> *  return;
</span><span style="color:#75715e">  }
</span><span style="color:#75715e">*/</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">date</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">date</span>) {
  <span style="color:#a6e22e">date</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">moment</span>.<span style="color:#a6e22e">unix</span>(<span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">date</span>).<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#39;MMM D, YYYY&#39;</span>);
  }
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">_highlightResult</span>.<span style="color:#a6e22e">title</span>.<span style="color:#a6e22e">value</span>;
  
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">breadcrumbs</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">_highlightResult</span>.<span style="color:#a6e22e">headings</span>) {
  <span style="color:#a6e22e">breadcrumbs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">_highlightResult</span>.<span style="color:#a6e22e">headings</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">match</span> =&gt; {
  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">`&lt;span class=&#34;post-breadcrumb&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">match</span>.<span style="color:#a6e22e">value</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;`</span>
  }).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39; &gt; &#39;</span>)
  }
  
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> ;
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">_highlightResult</span>.<span style="color:#a6e22e">content</span>){
  <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">_highlightResult</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">value</span>;
  }
  <span style="color:#66d9ef">else</span>{
  <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hit</span>.<span style="color:#a6e22e">summary</span>;
  }
  
  
  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">  &lt;div class=&#34;post-item&#34;&gt;
</span><span style="color:#e6db74">    &lt;span class=&#34;post-meta&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">date</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;
</span><span style="color:#e6db74">      &lt;h2&gt;&lt;a class=&#34;post-link&#34; href=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/a&gt;&lt;/h2&gt;
</span><span style="color:#e6db74">      &lt;a href=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; class=&#34;post-breadcrumbs&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">breadcrumbs</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/a&gt;
</span><span style="color:#e6db74">    &lt;div class=&#34;post-snippet&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">content</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/div&gt;
</span><span style="color:#e6db74">  &lt;/div&gt;
</span><span style="color:#e6db74">  `</span>;
}
  
<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">addWidget</span>(
  <span style="color:#a6e22e">instantsearch</span>.<span style="color:#a6e22e">widgets</span>.<span style="color:#a6e22e">searchBox</span>({
    <span style="color:#a6e22e">container</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#search-box&#39;</span>,
    <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Search&#39;</span>
  })
);
  
<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">addWidget</span>(
  <span style="color:#a6e22e">instantsearch</span>.<span style="color:#a6e22e">widgets</span>.<span style="color:#a6e22e">hits</span>({
    <span style="color:#a6e22e">container</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#hits&#39;</span>,
    <span style="color:#a6e22e">templates</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">hitTemplate</span>
    }
  })
);
  
<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">start</span>();
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div></li>
</ul>
<p>该文件内容原出自<a href="https://github.com/zhaohuabing/hugo-theme-cleanwhite/blob/master/layouts/partials/search.html">hugo-theme-cleanwhite</a>，我只是稍加修改。``标签内容未放上来，可以自己根据需要修改。</p>
<ul>
<li>
<p>修改 search 页面，在<code>layouts/search/</code>下建立文件<code>list.html</code>，具体内容根据自己网站修改，最重要的就是引入<code>search.html</code>，以下是我的<code>list.html</code>内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ partial &#34;general-title&#34; . }} {{ partial &#34;header&#34; . }} {{ partial &#34;navbar&#34; .
}}
<span style="color:#75715e">&lt;!-- Main --&gt;</span>
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;main&#34;</span>&gt;
  &lt;<span style="color:#f92672">article</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">header</span>&gt;
      &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;title&#34;</span>&gt;
        {{ if $.Scratch.Get &#34;h1&#34; }}
        &lt;<span style="color:#f92672">h1</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .RelPermalink }}&#34;</span>&gt;{{ .Title }}&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
        {{ $.Scratch.Set &#34;h1&#34; false }} {{ else }}
        &lt;<span style="color:#f92672">h2</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .RelPermalink }}&#34;</span>&gt;{{ .Title }}&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h2</span>&gt;
        {{ end }} {{ with .Description }}
        &lt;<span style="color:#f92672">p</span>&gt;{{ . }}&lt;/<span style="color:#f92672">p</span>&gt;
        {{ end }}
      &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">header</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;content&#34;</span>&gt;{{ partial &#34;search&#34; . }}&lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">article</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
{{ partial &#34;sidebar&#34; . }} {{ partial &#34;footer&#34; . }}
</code></pre></div></li>
<li>
<p>在导航栏或其他位置添加搜索入口：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;search&#34;</span> <span style="color:#a6e22e">role</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;search&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/search/&#34;</span>&gt;
  &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;q&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span> /&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div></li>
</ul>
<p>至此，就基本完成了，我的搜索界面效果如下：<br>
<a href="https://i.loli.net/2018/11/23/5bf7a0424f73f.png"><img src="https://i.loli.net/2018/11/23/5bf7a0424f73f.png" alt="search.png"></a></p>
<p><a href="https://i.loli.net/2018/11/23/5bf7a0424f73f.png">search.png</a></p>
<h2 id="结束语">结束语</h2>
<p>本来准备用 Serverless <a href="https://webtask.io/">Webtask Function</a>来实现 Algolia Index 的自动化更新，但是建立 Webtasks profile 过程中验证码一直提示错误，暂时放弃了。</p>

    </div>
    <div class="post-footer">
      
    </div>
    <div class="post-comment">
      
      


<span id="/post/hugo%E5%A2%9E%E5%8A%A0%E6%90%9C%E7%B4%A2%E6%A8%A1%E5%9D%97/" class="leancloud_visitors" data-flag-title="hugo增加搜索模块">
    <span class="post-meta-item-text">文章阅读量 </span>
    <span class="leancloud-visitors-count">1000000</span>
    <p></p>
  </span>
<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
  new Valine({
    el: '#vcomments' ,
    appId: 'cScQmclMsD4OOWCclCP1pNsz-gzGzoHsz',
    appKey: 'dtSaHLmdH3J4ICVVInYg9YFM',
    notify:  false ,
  verify:  false ,
  avatar:'mm',
    placeholder: '说点什么吧...',
    visitor:  true 
  });
</script>

    </div>
  </article>

    </main>
  </body>
</html>
